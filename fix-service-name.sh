#!/bin/bash

echo "ðŸ”§ Arreglando columna service_name faltante..."

API_URL="https://mvvxeqhsatkqtsrulcil.supabase.co"
SERVICE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12dnhlcWhzYXRrcXRzcnVsY2lsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODE3OTY3NywiZXhwIjoyMDczNzU1Njc3fQ.OcNBQsO8VEfdd6p87P4qVt74iHr8NeoDRAZ4r6fZmGU"

echo "ðŸ“‹ Agregando columna service_name a appointments..."

curl -X POST "$API_URL/rest/v1/rpc/exec_sql" \
  -H "apikey: $SERVICE_KEY" \
  -H "Authorization: Bearer $SERVICE_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "sql": "ALTER TABLE appointments ADD COLUMN IF NOT EXISTS service_name TEXT;"
  }'

echo -e "\nâœ… Columna service_name agregada"
echo "Ahora ejecuta: npm test"